// JayData 1.3.6
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki, Gábor Dolla
//
// More info: http://jaydata.org
(function(d){var l=d.Entity.inheritedTypeProcessor;d.kendo={};d.kendo.BaseModelType=kendo.data.Model.define({init:function(a){kendo.data.Model.fn.init.call(this,a)}});var q={"$data.Blob":"string","$data.String":"string","$data.Boolean":"boolean","$data.Integer":"number","$data.Number":"number","$data.Date":"date","$data.DateTimeOffset":"date","$data.Time":"string","$data.Byte":"number","$data.SByte":"number","$data.Int16":"number","$data.Int32":"number","$data.Int64":"number","$data.Decimal":"string",
"$data.Float":"number"};d.Entity.inheritedTypeProcessor=function(a){function f(b){var e=a.memberDefinitions,h={};e.getPublicMappedProperties().forEach(function(a){var c=d.Container.resolveName(a.type);h[a.name]={type:q[c]||"object",nullable:"$data.Boolean"===c?!0:!0!==a.required,defaultValue:a.defaultValue,editable:!a.computed,validation:{required:"$data.Boolean"===c?!1:a.required||"nullable"in a?!a.nullable:!1}}});var c={fields:h,init:function(c){var e=[];b&&b.owningContextType&&(e=b.owningContextType.memberDefinitions.getPublicMappedProperties().filter(function(a){return d.Container.resolveType(a.type)===
d.EntitySet}).map(function(a){return d.Container.resolveType(a.elementType)}));var h={entityBuilder:function(a,g){g.forEach(function(g){if(!0!==g.key&&(!0===g.required||!1===g.nullable)){var b=d.Container.resolveType(g.type);if(b.isAssignableTo&&b.isAssignableTo(d.Entity)&&-1===e.indexOf(b)){var f;c&&(f=c[g.name]);a[g.name]=new b(f,h)}}})}},g=c instanceof a?c:new a(c,h),f=g.initData,j={},k;for(k in f){var m=a.getMemberDefinition(k),i=f[k];if(i instanceof d.Entity)i=i.asKendoObservable(),j[k]=i;else if(m&&
d.Container.resolveType(m.type)===Array){var l=i=d.Container.resolveType(m.elementType);i.asKendoModel&&(l=i.asKendoModel());i=new kendo.data.ObservableArray(f[k],l);j[k]=i;j[k].bind("change",function(){g.changeFromKendo=!0;this.parent().dirty=!0;g[m.name]=this.toJSON();delete g.changeFromKendo})}else j[k]=m&&d.Container.resolveType(m.type)===d.Blob?d.Blob.toBase64(i):i}i=a.memberDefinitions.getPublicMappedProperties().filter(function(a){return d.Container.resolveType(a.dataType)===Array&&!d.Container.resolveType(a.elementType).asKendoModel});
for(k=0;k<i.length;k++){var n=i[k];if(null===f[n.name]||void 0===f[n.name])j[n.name]=new kendo.data.ObservableArray([],d.Container.resolveType(n.elementType)),j[n.name].bind("change",function(){g.changeFromKendo=!0;this.parent().dirty=!0;g[n.name]=this.toJSON();delete g.changeFromKendo})}var p=this;this.innerInstance=function(){return g};d.kendo.BaseModelType.fn.init.call(this,j);g.propertyChanged.attach(function(a,c){var b=c.newValue,e=g.getType().getMemberDefinition(c.propertyName);this.changeFromKendo?
d.Container.resolveType(e.type)===d.Blob&&(b=d.Blob.toString(b),b=d.Container.convertTo(atob(b),d.Blob),g.changeFromJay=!0,g.initData[e.name]=b,delete g.changeFromJay):(b=b?b.asKendoObservable?b.asKendoObservable():b:b,g.changeFromJay=!0,d.Container.resolveType(e.type)===d.Blob&&b&&(b=d.Blob.toBase64(b)),p.set(c.propertyName,b),e.computed&&p[c.propertyName]!==b&&(p[c.propertyName]=b),delete g.changeFromJay)});this.bind("set",function(a){var c=a.field,e=c.split(".");g.changeFromKendo=!0;1==e.length?
(e=a.value,g.changeFromJay||(e=e.innerInstance?e.innerInstance():e,g[c]=e,b&&b.autoSave&&g.save())):(c=g[e[0]],c instanceof d.Entity&&(g[e[0]]=c));delete g.changeFromKendo});b&&b.newInstanceCallback&&b.newInstanceCallback(g)},save:function(){return this.innerInstance().save()},remove:function(){return this.innerInstance().remove()}},e=e.getKeyProperties();switch(e.length){case 0:break;case 1:c.id=e[0].name;break;default:console.warn("entity with multiple keys not supported")}d.Trace.log("md",c);return kendo.data.Model.define(d.kendo.BaseModelType,
c)}function h(a,e){if(e.provider){var d=(e.databaseName||"")+(e.tableName||"")+(e.url||"")+(e.apiUrl||"")+(e.oDataServiceHost||""),c={provider:e.provider,databaseName:e.databaseName,tableName:e.tableName,dataSource:e.url,apiUrl:e.apiUrl,oDataServiceHost:e.oDataServiceHost};Object.keys(c).forEach(function(a){delete e[a]});a.setStore(d,c);return d}}a.asKendoModel=function(b){var e=b||a;return e.kendoModelType||(e.kendoModelType=f(b))};a.prototype.asKendoObservable=function(b){return new (a.asKendoModel(b))(this)};
a.asKendoDataSource=function(b,e,f){b=b||{};e=e||{};f=h(a,b)||f;f=d.ItemStore._getStoreAlias(a,f);return d.ItemStore._getContextPromise(f,a).getEntitySetFromElementType(a).asKendoDataSource(b,e)};l&&l(a)};d.Queryable.addMember("asKendoColumns",function(a){function f(a){a=Array.isArray(a)?a:[a];a=this.concat(a);return e(a)}function h(a){a=Array.isArray(a)?a:[a];a=a.concat(this);return e(a)}function b(a,c){var b=this.filter(function(c){return c.field==a})[0];$.extend(b,c);return this}function e(a){a.prepend=
h;a.append=f;a.setColumn=b;return a}var j=[],a=a||{},c=!0===a.$showComplexFields;delete a.$showComplexFields;this.defaultType.memberDefinitions.getPublicMappedProperties().forEach(function(b){if(c||q[d.Container.resolveName(b.type)]){var e={field:b.name};$.extend(e,a[b.name]||{});j.push(e)}});return e(j)});d.EntityContext.addProperty("EntitySetNames",function(){var a=this;return Object.keys(a._entitySetReferences).map(function(d){return a._entitySetReferences[d].tableName})});d.Queryable.addMember("asKendoModel",
function(a){a.owningContextType=a.owningContextType||this.entityContext.getType();return this.defaultType.asKendoModel(a)});d.Queryable.addMember("asKendoRemoteTransportClass",function(){var a=this,f=a.entityContext;return kendo.data.RemoteTransport.extend({init:function(){this.items=[]},read:function(h){a.entityContext.onReady().then(function(){var b=a,e=a.entityContext.storageProvider.supportedSetOperations.withInlineCount,f=!e&&a.entityContext.storageProvider.supportedSetOperations.length;e&&(b=
b.withInlineCount());if(h.data.filter){var c="",r={};h.data.filter.filters.forEach(function(a,b){0<b&&(c+="or"==h.data.filter.logic?" || ":" && ");switch(a.operator){case "eq":c+="it."+a.field;c+=" == this."+a.field;break;case "neq":c+="it."+a.field;c+=" != this."+a.field;break;case "startswith":c+="it."+a.field;c+=".startsWith(this."+a.field+")";break;case "contains":c+="it."+a.field;c+=".contains(this."+a.field+")";break;case "doesnotcontain":c+="!";c+="it."+a.field;c+=".contains(this."+a.field+
")";break;case "endswith":c+="it."+a.field;c+=".endsWith(this."+a.field+")";break;case "gte":c+="it."+a.field;c+=" >= this."+a.field;break;case "gt":c+="it."+a.field;c+=" > this."+a.field;break;case "lte":c+="it."+a.field;c+=" <= this."+a.field;break;case "lt":c+="it."+a.field;c+=" < this."+a.field;break;default:d.Trace.log("unknown operator",a.operator)}r[a.field]=a.value});b=b.filter(c,r)}var l=b;h.data.sort&&h.data.sort.forEach(function(a){b=b.order(("desc"==a.dir?"-":"")+a.field)});h.data.skip&&
(b=b.skip(h.data.skip));h.data.take&&(b=b.take(h.data.take));var o=[];o.push(b.toArray());f?o.push(l.length()):e||o.push(l.toArray());d.Trace.log(o);jQuery.when.apply(this,o).then(function(a,c){console.dir(arguments);var b={data:a.map(function(a){return a.asKendoObservable()}),total:e?a.totalCount:f?c:c.length};d.Trace.log(b);h.success(b)}).fail(function(){console.log("error in create");h.error({},arguments)})})},create:function(d,b){a.entityContext.onReady().then(function(){if(1<b.length){var a=
[];b.forEach(function(b){a.push(b.innerInstance())});f.addMany(a);f.saveChanges().then(function(){var b=[];a.forEach(function(a){b.push(a.initData)});d.success()}).fail(function(){console.log("error in create");d.error({},arguments);f.stateManager.reset()})}else console.dir(f.storeToken),b[0].innerInstance().save(f.storeToken).then(function(){d.success()}).fail(function(){console.log("error in create");d.error({},arguments)})})},update:function(d,b){a.entityContext.onReady().then(function(){1<b.length?
(b.map(function(a){return a.innerInstance()}).forEach(function(a){f.attach(a,!0)}),f.saveChanges().then(function(){d.success()}).fail(function(){f.stateManager.reset();d.error({},arguments)})):b[0].innerInstance().save().then(function(){d.success()}).fail(function(){d.error({},arguments)})})},destroy:function(d,b){a.entityContext.onReady().then(function(){1<b.length?(b.forEach(function(a){f.remove(a.innerInstance())}),f.saveChanges().then(function(){d.success({data:d.data})}).fail(function(){f.stateManager.reset();
d.error({},"error",d.data)})):b[0].innerInstance().remove().then(function(){d.success({data:d.data})}).fail(function(){f.stateManager.reset();d.error({},"error",d.data)})})},setup:function(){d.Trace.log("setup");d.Trace.log(arguments)}})});var s=kendo.data.DataSource.extend({init:function(){kendo.data.DataSource.fn.init.apply(this,arguments)},createItem:function(a){return new this.options.schema.model(a)},_promise:function(a,d,h){var b=this,e=$.extend,j=b.transport;return $.Deferred(function(c){j[h].call(j,
e({success:function(a){c.resolve({response:a,models:d,type:h})},error:function(a,d,e){c.reject(a);b.error(a,d,e)}},a),d)}).promise()}});d.kendo=d.kendo||{};d.kendo.defaultPageSize=25;d.Queryable.addMember("asKendoDataSource",function(a,f){var f=f||{},h=this.asKendoModel(f),a=a||{};a.serverPaging=a.serverPaging||!0;a.serverFiltering=a.serverFiltering||!0;a.serverSorting=a.serverSorting||!0;a.pageSize=void 0===a.pageSize?d.kendo.defaultPageSize:a.pageSize;var b=this.asKendoRemoteTransportClass(h);a.transport=
new b;a.schema={model:h,data:"data",total:"total"};return new s(a)});kendo.data.binders.submit=kendo.data.Binder.extend({init:function(a,d,h){kendo.data.Binder.fn.init.call(this,a,d,h);$(a).bind("submit",function(){var a=d.submit.source,e=a[d.submit.path];if("function"===typeof e)return e.apply(a,arguments),!1})},refresh:function(){}})})($data);
